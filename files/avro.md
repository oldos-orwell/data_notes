Avro - строковый формат хранения данных, используемый для сериализации данных. Он хранит схему в формате JSON, облегчая ее чтение и интерпретацию любой программой. Сами данные лежат в двоичном формате, компактно и эффективно. Система сериализации Avro нейтральна к языку. Файлы можно обрабатывать разными языками, в настоящее время это C, C++, C#, Java, Python и Ruby. Ключевой особенностью Avro является надежная поддержка схем данных, которые изменяются с течением времени, то есть эволюционируют. Avro понимает изменения схемы — удаление, добавление или изменение полей. Avro поддерживает разнообразные структуры данных.  
  
<img src="https://github.com/oldos-orwell/data_notes/blob/5a669bc7d3a0a6510918232420f86ff00f14530c/images/avro.png"></img>
  
Структура файла:
* заголовок
  * 4 байта, ASCII ‘O’, ‘b’, ‘j’, далее 1.
  * метаданные файла, содержащие схему – структуру представления данных.
  * 16-байтное случайное число — маркер файла.
* блоки данных - для блоков данных Avro может использовать компактную бинарную кодировку или человекочитаемый формат JSON, удобный для отладки.
  
Линейная структура данных формата Avro обеспечивает следующие преимущества:
* высокая скорость записи информации, что особенно важно в потоковых Big Data системах – именно поэтому Авро очень активно применяется в Apache Kafka и корпоративных озерах данных (Data Lake);
* формат отлично подходит для ETL-хранилищ и витрин данных, где требуется чтение всех полей записи, а не избирательно по столбцам, как в колоночно-ориентированных форматах.
* Прямое отображение в формат JSON, который часто используется для описания событий и объектов в Big Data системах;
* Поддержка множества языков программирования
* Широкие возможности по описанию объектов и событий, включая создание собственных схем данных, а также средства дополнения языка схемы, определяемые в чистом JSON

По сравнению с колоночно-ориентированными форматами (RCFile, Apache ORC и Parquet) Авро свойственны следующие недостатки:
* пониженная скорость чтения информации, поскольку требуется читать все поля записи;
* меньшая производительность при выполнении избирательных запросов;
* больший расход дискового пространства для хранения данных.
  
Пример авро схемы: 
```
{
  "type": "record",
  "name": "AvrosampleNetCore.AccountDetails",
  "fields": [
    {
      "name": "AccountId",
      "type": "int"
    },
    {
      "name": "AccountName",
      "type": "string"
    },
    {
      "name": "Accounts",
      "type": [
        "null",
        {
          "type": "array",
          "items": {
            "type": "record",
            "name": "AvrosampleNetCore.SubAccounts",
            "fields": [
              {
                "name": "AccountId",
                "type": "int"
              },
              {
                "name": "AccountType",
                "type": [ "null", "string" ]
              }
            ]
          }
        }
      ]
    }
  ]
}
```
Пример json данных для схемы выше: 
```
{
  "AccountId": 1212312,
  "AccountName": "TheCodebuzz",
  "SubAccounts": [
    {
      "AccountId": 34535,
      "AccountType": "Saving"
    }
  ]
}
```
___
[Форматы файлов в больших данных: краткий ликбез / Хабр](https://habr.com/ru/companies/vk/articles/504952/)  
[Формат Big Data файлов Avro: определение, структура и особенности](https://bigdataschool.ru/wiki/avro)  
[Как работает Apache Avro в Kafka, Hadoop и других системах Big Data](https://bigdataschool.ru/blog/kafka-big-data-apache-avro.html)  
[Understanding Avro file with example | TheCodeBuzz](https://www.thecodebuzz.com/sample-avro-file-example/)  
[Generate Avro schema from JSON | TheCodeBuzz](https://www.thecodebuzz.com/generate-avro-schema-from-json/)  
